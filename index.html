<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EV Energy Consumption and Range Chart</title>
    <script src="https://unpkg.com/react@17/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@17/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        const Slider = ({ value, onChange, min, max, step, label }) => (
            <div className="mb-4">
                <label className="block mb-2">{label}: {value}</label>
                <input
                    type="range"
                    min={min}
                    max={max}
                    step={step}
                    value={value}
                    onChange={(e) => onChange(parseFloat(e.target.value))}
                    className="w-full"
                />
            </div>
        );

        const EVEnergyConsumptionChart = () => {
            const [cx, setCx] = useState(0.24);
            const [frontalArea, setFrontalArea] = useState(2.96);
            const [crr, setCrr] = useState(0.015);
            const [baseMass, setBaseMass] = useState(1800);
            const [efficiency, setEfficiency] = useState(94);
            const [batteryCapacity, setBatteryCapacity] = useState(100);

            const chartRef = useRef(null);
            const chartInstance = useRef(null);

            const calculateEnergy = (speed) => {
                const airDensity = 1.225;
                const gravityAcceleration = 9.81;
                const speedMps = speed * 0.44704;

                const airDragForce = 0.5 * cx * frontalArea * airDensity * Math.pow(speedMps, 2);
                const rollingResistanceForce = crr * baseMass * gravityAcceleration;

                const totalForce = airDragForce + rollingResistanceForce;
                const powerRequired = totalForce * speedMps;
                const powerRequiredWithEfficiency = powerRequired / (efficiency / 100);

                const energyConsumption = powerRequiredWithEfficiency / speed;
                const range = (batteryCapacity * 1000) / energyConsumption;

                return { energyConsumption, range };
            };

            useEffect(() => {
                if (chartInstance.current) {
                    chartInstance.current.destroy();
                }

                const ctx = chartRef.current.getContext('2d');
                const speeds = Array.from({ length: 100 }, (_, i) => i + 1);
                const data = speeds.map(speed => calculateEnergy(speed));

                chartInstance.current = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: speeds,
                        datasets: [
                            {
                                label: 'Energy Consumption (Wh/mile)',
                                data: data.map(d => d.energyConsumption),
                                borderColor: 'rgb(255, 99, 132)',
                                yAxisID: 'y',
                            },
                            {
                                label: 'Range (miles)',
                                data: data.map(d => d.range),
                                borderColor: 'rgb(54, 162, 235)',
                                yAxisID: 'y1',
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        interaction: {
                            mode: 'index',
                            intersect: false,
                        },
                        scales: {
                            x: {
                                title: {
                                    display: true,
                                    text: 'Speed (mph)'
                                }
                            },
                            y: {
                                type: 'linear',
                                display: true,
                                position: 'left',
                                title: {
                                    display: true,
                                    text: 'Energy Consumption (Wh/mile)'
                                },
                            },
                            y1: {
                                type: 'linear',
                                display: true,
                                position: 'right',
                                title: {
                                    display: true,
                                    text: 'Range (miles)'
                                },
                                grid: {
                                    drawOnChartArea: false,
                                },
                            },
                        }
                    }
                });

                return () => {
                    if (chartInstance.current) {
                        chartInstance.current.destroy();
                    }
                };
            }, [cx, frontalArea, crr, baseMass, efficiency, batteryCapacity]);

            return (
                <div className="p-4 max-w-4xl mx-auto">
                    <h2 className="text-2xl font-bold mb-4">EV Energy Consumption and Range Chart</h2>
                    <Slider label="Drag Coefficient (Cx)" value={cx} onChange={setCx} min={0.1} max={0.5} step={0.01} />
                    <Slider label="Frontal Area (mÂ²)" value={frontalArea} onChange={setFrontalArea} min={1} max={5} step={0.1} />
                    <Slider label="Rolling Resistance Coefficient" value={crr} onChange={setCrr} min={0.001} max={0.02} step={0.001} />
                    <Slider label="Base Mass (kg)" value={baseMass} onChange={setBaseMass} min={1000} max={4000} step={50} />
                    <Slider label="Drivetrain Efficiency (%)" value={efficiency} onChange={setEfficiency} min={80} max={100} step={1} />
                    <Slider label="Battery Capacity (kWh)" value={batteryCapacity} onChange={setBatteryCapacity} min={10} max={500} step={1} />
                    <div className="mt-4">
                        <canvas ref={chartRef}></canvas>
                    </div>
                </div>
            );
        };

        ReactDOM.render(<EVEnergyConsumptionChart />, document.getElementById('root'));
    </script>
</body>
</html>
